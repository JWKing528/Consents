<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> -->
<!-- <meta http-equiv='refresh' content='0; URL=nhiapp://nhi/vcard'> -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IIS Windows</title>
<style type="text/css">
<!--
body {
	color:#000000;
	background-color:#0072C6;
	margin:0;
}

#container {
	margin-left:auto;
	margin-right:auto;
	text-align:center;
	}

a img {
	border:none;
}

-->
</style>

</head>
<body>
	 <script>
	window.onload = function()
	//function redirect()
	{
	

	            var userAgent = navigator.userAgent || navigator.vendor || window.opera;
	            var appStoreUrl = '';
		    var appLink = "nhiapp://nhi/vcard";

		let hidden, visibilityChange; 
	            if (typeof document.hidden !== "undefined") {
	                hidden = "hidden";
	                visibilityChange = "visibilitychange";
	            } else if (typeof document.msHidden !== "undefined") {
	                hidden = "msHidden";
	                visibilityChange = "msvisibilitychange";
	            } else if (typeof document.webkitHidden !== "undefined") {
	                hidden = "webkitHidden";
	                visibilityChange = "webkitvisibilitychange";
	            }
		
	            if (/android/i.test(userAgent)) {
	                appStoreUrl = 'https://play.google.com/store/apps/details?id=com.nhiApp.v1&hl=zh_TW&pli=1';
	            } else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
	                appStoreUrl = 'https://apps.apple.com/tw/app/%E5%85%A8%E6%B0%91%E5%81%A5%E4%BF%9D%E8%A1%8C%E5%8B%95%E5%BF%AB%E6%98%93%E9%80%9A-%E5%81%A5%E5%BA%B7%E5%AD%98%E6%91%BA/id578186283';
	            } else {
	                appStoreUrl = 'https://www.google.com';
	            }

		    // 嘗試開啟 APP
	            const now = Date.now();
	            window.location.href = appLink;

		// 檢查頁面是否變為不可見
	            document.addEventListener(visibilityChange, function() {
	                if (!document[hidden] && Date.now() - now < 2000) {
	                    window.location.href = appStoreUrl;
	                }
	            }, false);
	
	            // 如果頁面一直可見，則在2秒後導向應用商店
	            setTimeout(() => {
	                if (!document[hidden] && Date.now() - now >= 2000) {
	                    window.location.href = appStoreUrl;
	                }
	            }, 2000);
		
	            // 2 秒後檢查是否成功開啟 APP，否則導向商店
	            //setTimeout(() => {
	            //    if (Date.now() - now < 2000) {
	            //        window.location.href = appStoreUrl;
	            //    }
	            //}, 1500);
		
	            //var start = new Date().getTime();
	            //var interval = setInterval(function() {
	            //    var now = new Date().getTime();
	            //    if (now - start > 2000) {
	            //        clearInterval(interval);
	            //        window.location = appStoreUrl;
	            //    }
	            //}, 100);
	
	            //window.location = 'nhiapp://nhi/vcard';
		    //window.location = 'thinkcloud://';
	
	            //setTimeout(function() {
	            //    clearInterval(interval);
	            //}, 2000);
	        
	 }
	</script>
	
	<button onclick="redirect()">~電子簽名~</button>
   
</body>
</html>
